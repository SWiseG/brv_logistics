{% load static %}
<header> 
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="{% url 'core:home' %}">
                {% if active_theme and active_theme.logo %}
                    <img src="{{ active_theme.logo.url }}" alt="Logo" height="30">
                {% else %}
                    {{ sys_config.site_name|default:"BRV Logistics" }}
                {% endif %}
            </a>
            <a class="navbar-localize" href="#" data-bind="click: $root.onAddress">
                <div class="navbar-localize-container-title">
                    {% if user.is_authenticated %}
                        <span class="navbar-localize-title" data-i18n="navbar.localize-title"></span>
                        <p class="navbar-localize-title-user">{{ user.first_name }}</p>
                    {% else %}
                        <p class="navbar-localize-title-user" data-i18n="navbar.update-cep"></p>
                    {% endif %}
                </div>
                <div class="navbar-localize-container-address">
                    <i class="navbar-localize-icon fas fa-map-marker-alt"></i>
                    {% if user.is_authenticated %}
                        {% with user.addresses.all as addresses %}
                            {% if addresses %}
                                {% with False as encontrado %}
                                    {% for address in addresses %}
                                        {% if not encontrado and address.is_default %}
                                            {% if address.address_type == "shipping" or address.address_type == "both" %}
                                                <p>{{ address.city }} {{ address.postal_code }}</p>
                                                {% with True as encontrado %}{% endwith %}
                                            {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                    {% comment %} {% if not encontrado %}
                                        <p data-i18n="navbar.localize-address-not-found"></p>
                                    {% endif %} {% endcomment %}
                                {% endwith %}
                            {% else %}
                                <p data-i18n="navbar.localize-address-not-found"></p>
                            {% endif %}
                        {% endwith %}
                    {% else %}
                        <p data-i18n="navbar.localize-address-not-found"></p>
                    {% endif %}
                </div>

            </a>
            <div class="navbar-search">
                <form action="{% url 'products:search' %}" method="GET">
                    <div class="editor-form-field with-actions" actions="1" style="margin: 0;">
                        <div class="editor-form-input">
                            <input type="text" 
                                    name="q" 
                                    class="form-control" 
                                    autocomplete="off"
                                    id="navbarSearchInput"
                                    value="{{ request.GET.q|default:'' }}">
                            <button type="submit" class="btn btn-primary-darker custom-action"><i class="fas fa-search"></i></button>
                        </div>
                    </div>
                </form>
                <div id="searchSuggestions" class="search-suggestions position-absolute" style="top: 85%; z-index: 1050; display: none">
                    <!-- Conteúdo será carregado via AJAX -->
                </div>
            </div>
            <div class="navbar-settings" id="navOptions">
                <div class="navbar-nav">
                    <div class="nav-item user dropdown">
                        {% if user.is_authenticated %}
                            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <div class="navbar-settings-container-welcome">
                                    <span data-i18n="navbar.welcome"></span>, {{ user.get_short_name|default:user.username }}
                                </div>
                                <div class="navbar-settings-container-title">
                                    <span data-i18n="navbar.welcome-title-drop"></span>
                                </div>
                            </a>
                            <div class="dropdown-menu navbar-dropdown-settings" role="dropdown-menu" aria-labelledby="userDropdown">
                                <div class="dropdown-header">
                                    <strong>{{ user.get_full_name|default:user.username }}</strong>
                                    <small>{{ user.email }}</small>
                                </div>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="{% url 'auth:profile' %}">
                                    <i class="fas fa-user-circle me-2"></i>
                                    <span data-i18n="navbar.my-profile"></span>
                                </a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="{% url 'auth:logout' %}">
                                    <i class="fas fa-sign-out-alt me-2"></i>
                                    <span data-i18n="navbar.logout"></span>
                                </a>
                            </div>
                        {% else %}
                            <a class="nav-link dropdown-toggle" href="{% url 'auth:login' %}" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <div class="navbar-settings-container-welcome">
                                    <span data-i18n="navbar.welcome"></span>,<span data-i18n="navbar.make-login"></span>,
                                </div>
                                <div class="navbar-settings-container-title">
                                    <span data-i18n="navbar.welcome-title-drop"></span>
                                </div>
                            </a>
                            <div class="dropdown-menu navbar-dropdown-settings" role="dropdown-menu" aria-labelledby="userDropdown"></div>
                        {% endif %}
                    </div>
                    <div class="nav-item actions">
                        <!-- Wishlist -->
                        <div class="wishlist-container">
                            <div class="dropdown nav-wishlist" data-bs-auto-close="outside">
                                <a class="nav-link cart-trigger" href="#" data-bs-toggle="dropdown" id="wishlistDropdown">
                                    <div class="cart-icon-container">
                                        <i class="fas fa-heart"></i>
                                        <span class="cart-count badge" data-bind="text: $root.wishlistCount">0</span>
                                    </div>
                                </a>
                                
                                <div class="dropdown-menu wishlist-dropdown" role="dropdown-menu" aria-labelledby="wishlistDropdown" id="wishlistDropdownMenu">
                                    <!-- Content será criado dinamicamente pelo JavaScript -->
                                </div>
                            </div>
                        </div>
    
                        <!-- Cart Dropdown -->
                        <div class="cart-container">
                            <div class="dropdown nav-cart" data-bs-auto-close="outside">
                                <a class="nav-link cart-trigger" href="#" data-bs-toggle="dropdown" id="cartDropdown">
                                    <div class="cart-icon-container">
                                        <i class="fas fa-shopping-cart"></i>
                                        <span class="cart-count badge" data-bind="text: $root.cartCount">0</span>
                                    </div>
                                    <div class="cart-text">
                                        <div class="cart-total">
                                            <span data-bind="text: $root.cartTotal">0,00</span>
                                        </div>
                                    </div>
                                </a>
                                
                                <div class="dropdown-menu cart-dropdown" role="dropdown-menu" aria-labelledby="cartDropdown" id="cartDropdownMenu">
                                    <!-- Content será criado dinamicamente pelo JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    <subnav>
        <div id="subnav-controll" class="navbar-subnav">
            <div class="arrow left" id="subnav-scroll-arrow-left">&#10094;</div>
            <ul class="subnav-controll-list">
                <!-- Categories Dropdown -->
                <li class="nav-item dropdown mega-dropdown categories-dropdown-all">
                    <a href="#" class="nav-link dropdown-toggle px-3 py-2" 
                        data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-bars"></i>
                        <span data-i18n="navbar.search-title-categories"></span>
                    </a>
                    <div class="dropdown-menu mega-menu p-0" role="dropdown-menu">
                        <div class="container">
                            {% for category in main_categories %}
                                <div class="dropdown-content">
                                    <a class="dropdown-header" href="{{ category.get_absolute_url }}" class="text-decoration-none" data-bs-toggle="tooltip" title="{{ category.name }}">
                                        <span>{{ category.name }}</span>
                                        <small class="text-muted">({{ category.product_count|default:0 }})</small>
                                    </a>
                                    {% if category.children.count > 0 %}
                                        <div class="sub-categories-list">
                                            {% for subcategory in category.children.all %}
                                                <a class="sub-item" href="{{ subcategory.get_absolute_url }}" data-bs-toggle="tooltip" title="{{ subcategory.name }}">
                                                    <i class="fas fa-chevron-right"></i>
                                                    <span class="dropdown-item py-1">
                                                        <span>{{ subcategory.name }}</span>
                                                        {% comment %} <small class="text-muted">({{ subcategory.product_count|default:0 }})</small> {% endcomment %}
                                                    </span>
                                                </a>
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        <div class="sub-categories-list"></div>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </li>

                <!-- Offers -->
                <li class="subnav-item">
                    <a href="{% url 'products:offers' %}" class="subnav-link link-context">
                        <i class="fas fa-tags me-2"></i>
                        <span data-i18n="subnav.offers"></span>
                        <span class="badge bg-danger ms-1" data-i18n="subnav.hot"></span>
                    </a>
                </li>

                <!-- Main Categories -->
                {% for category in main_categories|slice:":4" %}
                    <li class="subnav-item">
                        <a href="{{ category.get_absolute_url }}" class="subnav-link">
                            {{ category.name }}
                        </a>
                    </li>
                {% endfor %}

                <!-- Contact -->
                <li class="subnav-item">
                    <a class="subnav-link" href="{% url 'core:contact' %}" data-i18n="navbar.contacts"></a>
                </li>
            </ul>
            <div class="arrow right" id="subnav-scroll-arrow-right">&#10095;</div>
        </div>
    </subnav>
</header>
<module data-tag="{% static 'js/modules/navbar.js' %}"></module>